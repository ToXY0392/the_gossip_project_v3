<article class="card shadow-sm border-secondary-subtle">
  <div class="card-body p-4 p-md-5">
    <p class="gossip-kicker text-uppercase mb-2">Dossier complet</p>
    <h1 class="display-6 mb-3"><%= @gossip.title %></h1>

    <div class="d-flex flex-wrap align-items-center gap-2 mb-4">
      <span class="badge text-bg-dark border border-secondary-subtle">Source interne</span>
      <% if @gossip.tags.any? %>
        <% @gossip.tags.each do |tag| %>
          <span class="badge text-bg-secondary border border-secondary-subtle"><%= tag.title %></span>
        <% end %>
      <% end %>
      <span class="text-body-secondary">Par <%= link_to @gossip.user.first_name, user_path(@gossip.user), class: "link-light link-offset-2" %></span>
      <span class="text-body-secondary">·</span>
      <span class="text-body-secondary">Ville : <%= link_to @gossip.user.city.name, city_path(@gossip.user.city), class: "link-light link-offset-2" %></span>
    </div>

    <blockquote class="blockquote border-start border-4 border-danger ps-3 mb-4">
      <p class="mb-0"><%= @gossip.content %></p>
    </blockquote>

    <div class="d-flex gap-2">
      <%= link_to "Retour aux gossips", root_path, class: "btn btn-outline-light" %>
      <%= link_to "Voir l'auteur", user_path(@gossip.user), class: "btn btn-danger" %>
      <%= link_to "Modifier", edit_gossip_path(@gossip), class: "btn btn-warning" %>
      <%= button_to "Supprimer",
                    gossip_path(@gossip),
                    method: :delete,
                    form: { data: { turbo_confirm: "Tu es sûr de vouloir supprimer ce potin ?" } },
                    class: "btn btn-outline-danger" %>
    </div>
  </div>
</article>

<section class="mt-4">
  <div class="card shadow-sm border-secondary-subtle">
    <div class="card-body p-4">
      <h2 class="h5 mb-3">Commentaires (<%= @gossip.comments.count %>)</h2>

      <%= form_with model: [@gossip, @gossip.comments.build], url: gossip_comments_path(@gossip), local: true, class: "mb-4" do |f| %>
        <div class="mb-2">
          <%= f.label :content, "Ajouter un commentaire", class: "form-label" %>
          <%= f.text_area :content, rows: 2, class: "form-control", placeholder: "Ton avis sur ce potin…", required: true %>
        </div>
        <%= f.submit "Publier", class: "btn btn-gossip btn-sm" %>
      <% end %>

      <div class="list-group list-group-flush">
        <% @gossip.comments.includes(:user).each do |comment| %>
          <div class="list-group-item bg-transparent px-0 py-3 border-secondary border-opacity-25">
            <div class="d-flex justify-content-between align-items-start gap-2 flex-wrap">
              <div>
                <span class="fw-medium"><%= comment.user.first_name %></span>
                <span class="text-body-secondary small">·</span>
                <span class="text-body-secondary small"><%= comment.content %></span>
              </div>
              <%= link_to "Modifier", edit_comment_path(comment), class: "btn btn-outline-light btn-sm" %>
            </div>
          </div>
        <% end %>
      </div>

      <% if @gossip.comments.empty? %>
        <p class="text-body-secondary small mb-0">Aucun commentaire pour le moment.</p>
      <% end %>
    </div>
  </div>
</section>
